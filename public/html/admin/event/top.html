<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8">
		<meta name="keyword" content="">
		<meta name="description" content="">
		<meta http-equiv="Content-Style-Type" content="text/css">
		<link href="../css/workpage.css" rel="stylesheet" type="text/css" media="all">
		<script src="../js/jquery-1.10.2.min.js"></script>
		<script src="../js/rowClick.1.0.js"></script>
		<script>
			$(document).ready(function(){
				$('#eveTable').rowClick();
				$('#searchbutton').click(function() {
		    	// 多重送信を防ぐため通信完了までボタンをdisableにする
	   			var button = $(this);
	   			button.attr("disabled", true);
	   			
			    // 各フィールドから値を取得してJSONデータを作成
    			var data = {
    			    name: $("#name").val(),
    			    place:$("#place").val(),
        			day : $("#day").val()
   				 };
    
  				  console.log(data);
  				  // 通信実行
			    $.ajax({
			        type:"post",                // method = "POST"
			        url:"/admin/event/find",        // POST送信先のURL
			        data:JSON.stringify(data),  // JSONデータ本体
			        contentType: 'application/json', // リクエストの Content-Type
			        dataType: "json",           // レスポンスをJSONとしてパースする
			        success: function(json_data) {   // 200 OK時
			            // JSON Arrayの先頭が成功フラグ、失敗の場合2番目がエラーメッセージ
			            if (!json_data[0]) {    // サーバが失敗を返した場合
			                alert("Transaction error. " + json_data[1]);
			                return;
			            }
			            // 成功時処理
			            location.reload();
			        },
			        
			        error: function() {         // HTTPエラー時
			            alert("Server Error. Pleasy try again later.");
			        },
			        complete: function() {      // 成功・失敗に関わらず通信が終了した際の処理
			            button.attr("disabled", false);  // ボタンを再び enableにする
			        }
			    });
			});

		</script>
		<title>イベント情報ページ</title>
	</head>
	<body>
		<div id="warpper">
			<div id="header">
				<ul>
					<li><a href="/admin/student">学生関連</a></li>
					<li><a href="/admin/event">イベント情報</a></li>
					<li><a href="/logout">logout</a></li>
				</ul>
			</div><!-- #header end -->
			<div id="eveMain">
				<form name="eveSearch" class="eveSearch" action="#" method="POST">
					<p>イベント名 : <input type="text" name="name" placeholder="event name" size="40" id="name"></p>
					<p>場所 : <input type="text" name="place" placeholder="place" size="40" id="place"></p>
					<p>日付 : <input type="date" name="day" id="day"></p>
					<input type="button" value="検索" class="searchbutton" id="searchbutton">
				</form><!-- #eveSearch end -->
				<div id="eveContents">
					<p id="newEveEntry">
						<a href="/admin/event/add">新規イベント登録</a>
					</p><!-- #newentry end -->
					<p id="hit">11件ヒットしました！！！</p>
					<table id="eveTable">
						<thead>
							<tr class="eveHead">
								<th scope="col">イベント名</th>
								<th scope="col">開催日</th>
								<th scope="col">開催地区</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td><a href="/admin/event/detail">カエル界忘年会</a></td>
								<td>2013/12/20</td>
								<td>長野県長野市</td>
							</tr>
						</tbody>
					</table><!-- #eveTable end -->
				</div><!-- #eveContents end -->
			</div><!-- #eveMain end -->
		</div><!-- #warpper end -->
	</body>
</html>
<!-- -->